digraph "top" {
  // Base Styling
  compound=true
  graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9"];

  // Start and end nodes
  reality[ label="Reality"  fontname="Arial"  fontsize="20"  fontcolor="white"  fillcolor="black"  color="black"  shape="box"  style="filled, rounded" ]
  attacker_wins[ label="ATTACKER WINS!"  fontname="Arial"  fontsize="20"  fontcolor="red"  fillcolor="yellow"  color="red"  shape="box"  style="filled, rounded" ]
  subgraph cluster_Request_service_to_add_a_new_user {
    label=<<B>Request service<br></br>to add a new user</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_Input_sanitization {
      label=<<B>Input<br></br>sanitization</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3" ];
      Sanitize_SQL_content_from_request_parameters[label="Sanitize SQL\ncontent from request\nparameters"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
      {rank="same"; }
    }
    SQL_Injection_via_request_parameters[label="SQL Injection via\nrequest parameters"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> Sanitize_SQL_content_from_request_parameters
  reality -> SQL_Injection_via_request_parameters
  Sanitize_SQL_content_from_request_parameters -> attacker_wins[style="invis"]
  SQL_Injection_via_request_parameters -> attacker_wins[style="invis"]
  subgraph cluster_Add_record_to_Database {
    label=<<B>Add record to<br></br>Database</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_Input_sanitization {
      label=<<B>Input<br></br>sanitization</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3" ];
      Sanitize_SQL_content_before_building_query[label="Sanitize SQL\ncontent before building\nquery"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
      {rank="same"; }
    }
    SQL_Injection_during_insert_operation[label="SQL Injection\nduring 'insert'\noperation"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> Sanitize_SQL_content_before_building_query
  reality -> SQL_Injection_during_insert_operation
  Sanitize_SQL_content_before_building_query -> attacker_wins[style="invis"]
  SQL_Injection_during_insert_operation -> attacker_wins[style="invis"]
  subgraph cluster_Records_access {
    label=<<B>Records access</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Request_for_bulk_user_data[label="Request for bulk\nuser data"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Design_service_to_block_bulk_records_requests[label="Design service to\nblock bulk records\nrequests"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; }
  }
  reality -> Request_for_bulk_user_data
  reality -> Design_service_to_block_bulk_records_requests
  subgraph cluster_Records_management {
    label=<<B>Records<br></br>management</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Unauthorized_modification_of_table[label="Unauthorized\nmodification of table"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Restrict_the_tables_accessible_by_a_each_db_account_to_a_small_subset[label="Restrict the\ntables accessible by a\neach db account to a\nsmall subset"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; }
  }
  reality -> Unauthorized_modification_of_table
  reality -> Restrict_the_tables_accessible_by_a_each_db_account_to_a_small_subset
  subgraph cluster_Security_of_business_logic {
    label=<<B>Security of<br></br>business logic</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Service_runs_with_elevated_privileges_on_host[label="Service runs with\nelevated privileges on\nhost"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Setup_container_or_VM_hosting_service_with_minimum_rights[label="Setup container\nor VM hosting\nservice with minimum\nrights"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; }
  }
  reality -> Service_runs_with_elevated_privileges_on_host
  reality -> Setup_container_or_VM_hosting_service_with_minimum_rights
  subgraph cluster_Frontend_security {
    label=<<B>Frontend<br></br>security</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_DoS_Protection {
      label=<<B>DoS Protection</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="white"  fillcolor="dimgray"  color="dimgray" ];
      rate_limiting_exists[label="rate limiting\nexists"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
      honeypots_exist_to_handle_excessive_malicious_requests[label="honeypots exist\nto handle excessive\nmalicious requests"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
      {rank="same"; rate_limiting_exists; honeypots_exist_to_handle_excessive_malicious_requests; }
    }
    Unauthorized_requests[label="Unauthorized\nrequests"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> rate_limiting_exists[lhead=cluster_DoS_Protection]
  rate_limiting_exists -> Unauthorized_requests[ltail=cluster_DoS_Protection]
  Unauthorized_requests -> attacker_wins[style="invis"]
  subgraph cluster_Database_Security {
    label=<<B>Database<br></br>Security</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_Database_Security_Policies {
      label=<<B>Database<br></br>Security Policies</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3" ];
      Use_operationspecific_add_read_update_accounts_when_performing_db_operations[label="Use\noperation-specific (add, read,\nupdate) accounts when\nperforming db operations"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
      {rank="same"; }
    }
    SQL_queries_are_run_with_dbadmin_privileges[label="SQL queries are\nrun with db-admin\nprivileges"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> Use_operationspecific_add_read_update_accounts_when_performing_db_operations
  reality -> SQL_queries_are_run_with_dbadmin_privileges
  Use_operationspecific_add_read_update_accounts_when_performing_db_operations -> attacker_wins[style="invis"]
  SQL_queries_are_run_with_dbadmin_privileges -> attacker_wins[style="invis"]
  subgraph cluster_Data_Security {
    label=<<B>Data Security</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Force_deletion_of_sensitive_and_critical_data[label="Force deletion of\nsensitive and critical data"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    active_and_disabled_are_valid_values_for_status_column[label="'active' and\n'disabled' are valid values\nfor 'status' column"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Delete_requests_should_only_disable_a_record_not_delete_it[label="Delete requests\nshould only disable a\nrecord, not delete it"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    table_schema_has_a_status_column[label="table schema has a\n'status' column"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    {rank="same"; table_schema_has_a_status_column; active_and_disabled_are_valid_values_for_status_column; }
  }
  table_schema_has_a_status_column -> Delete_requests_should_only_disable_a_record_not_delete_it
  reality -> Force_deletion_of_sensitive_and_critical_data
  reality -> table_schema_has_a_status_column
  reality -> active_and_disabled_are_valid_values_for_status_column
  active_and_disabled_are_valid_values_for_status_column -> Delete_requests_should_only_disable_a_record_not_delete_it
  Force_deletion_of_sensitive_and_critical_data -> Delete_requests_should_only_disable_a_record_not_delete_it
  subgraph cluster_Client_data_requests {
    label=<<B>Client data<br></br>requests</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Trigger_DoS_by_flooding_frontend_with_readrequests[label="Trigger DoS by\nflooding frontend with\nread-requests"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Use_rate_limiting_to_control_resource_utilization_per_request[label="Use rate limiting\nto control resource\nutilization per request"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; }
  }
  reality -> Trigger_DoS_by_flooding_frontend_with_readrequests
  reality -> Use_rate_limiting_to_control_resource_utilization_per_request
  subgraph cluster_Database_Security_related_to_breaches {
    label=<<B>Database<br></br>Security related to<br></br>breaches</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    Unauthorized_access_to_Database[label="Unauthorized\naccess to Database"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Bulk_download_database_records[label="Bulk download\ndatabase records"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    For_nonread_operations_use_accounts_that_dont_have_read_rights[label="For non-read\noperations, use accounts that\ndon't have read rights"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    Monitor_DB_traffic_and_block_large_reads_from_DB[label="Monitor DB\ntraffic and block large\nreads from DB"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; }
  }
  reality -> Unauthorized_access_to_Database
  reality -> Bulk_download_database_records
  reality -> For_nonread_operations_use_accounts_that_dont_have_read_rights
  reality -> Monitor_DB_traffic_and_block_large_reads_from_DB
  subgraph cluster_DB_Records_security {
    label=<<B>DB Records<br></br>security</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_Database_Security_Policies {
      label=<<B>Database<br></br>Security Policies</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3" ];
      Never_allow_delete_operations[label="Never allow\ndelete operations"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
      {rank="same"; }
    }
    Unauthorized_delete_operation[label="Unauthorized\ndelete operation"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> Never_allow_delete_operations
  reality -> Unauthorized_delete_operation
  Never_allow_delete_operations -> attacker_wins[style="invis"]
  Unauthorized_delete_operation -> attacker_wins[style="invis"]
  subgraph cluster_Client_side_attacks {
    label=<<B>Client side<br></br>attacks</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    webpage_has_string_fields[label="webpage has\nstring fields"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Inject_javascript_into_client_webpage[label="Inject\njavascript into client\nwebpage"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    Sanitize_all_UI_input_fields[label="Sanitize all UI\ninput fields"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    Sanitize_all_URL_query_fields[label="Sanitize all URL\nquery fields"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    {rank="same"; webpage_has_string_fields; webpage_has_string_fields; }
  }
  reality -> webpage_has_string_fields
  reality -> Sanitize_all_URL_query_fields
  webpage_has_string_fields -> Inject_javascript_into_client_webpage
  webpage_has_string_fields -> Sanitize_all_UI_input_fields
  Inject_javascript_into_client_webpage -> Sanitize_all_UI_input_fields
  subgraph cluster_Prepare_and_add_new_records {
    label=<<B>Prepare and add<br></br>new records</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    subgraph cluster_Input_sanitization {
      label=<<B>Input<br></br>sanitization</B>>
      graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Times"  fontsize="18"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3" ];
      Sanitize_SQL_content_from_input_strings[label="Sanitize SQL\ncontent from input\nstrings"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
      {rank="same"; }
    }
    SQL_Injection_via_input_strings[label="SQL Injection via\ninput strings"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    {rank="same"; }
  }
  reality -> Sanitize_SQL_content_from_input_strings
  reality -> SQL_Injection_via_input_strings
  Sanitize_SQL_content_from_input_strings -> attacker_wins[style="invis"]
  SQL_Injection_via_input_strings -> attacker_wins[style="invis"]
  Inject_javascript_into_client_webpage -> attacker_wins[ penwidth="4"  color="red" ]
  Force_deletion_of_sensitive_and_critical_data -> attacker_wins[ penwidth="4"  color="red" ]
  subgraph cluster_Legend {
    label="Legend"
    graph[style="filled, rounded" rankdir="LR" fontsize="16" splines="true" overlap="false" nodesep="0.1" ranksep="0.2" fontname="Courier" fillcolor="lightyellow" color="yellow"];
    A[label="Pre-\nCondition"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    B[label="Assumptions"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="dimgray"  color="dimgray"]
    C[label="Attack"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="red"  color="red"]
    D[label="Pre-emptive\nDefense"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="purple"  color="blue"]
    E[label="Incident\nResponse"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="blue"  color="blue"]
    F[label="Policy"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3"]
  }
  A -> reality [style="invis" ltail="cluster_Legend"]
  B -> reality [style="invis" ltail="cluster_Legend"]
  C -> reality [style="invis" ltail="cluster_Legend"]
  D -> reality [style="invis" ltail="cluster_Legend"]
  E -> reality [style="invis" ltail="cluster_Legend"]
  F -> reality [style="invis" ltail="cluster_Legend"]
}